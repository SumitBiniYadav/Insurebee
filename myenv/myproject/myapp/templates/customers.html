{% extends "slidebar.html" %}

{% block title %}InsureBee Customers{% endblock %}

{% block page_title %}Customer Management{% endblock %}

{% block additional_styles %}
/* Customer Management Styles */
.customer-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.search-container {
    flex: 1;
    max-width: 500px;
    position: relative;
}

.search-container input {
    width: 100%;
    padding: 10px 15px 10px 40px;
    border-radius: 8px;
    border: 1px solid #ddd;
    font-size: 16px;
    transition: border-color 0.3s;
}

.search-container input:focus {
    border-color: var(--primary);
    outline: none;
}

.search-container i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #888;
}

.filter-options {
    display: flex;
    gap: 10px;
}

.filter-button {
    background-color: white;
    border: 1px solid #ddd;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    transition: all 0.3s;
}

.filter-button:hover {
    border-color: var(--primary);
}

.filter-button i {
    margin-right: 8px;
}

.filter-button.active {
    background-color: var(--primary);
    border-color: var(--primary);
    color: var(--text-dark);
}

.export-button {
    background-color: var(--primary);
    color: var(--text-dark);
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    display: flex;
    align-items: center;
    transition: background-color 0.3s;
}

.export-button:hover {
    background-color: var(--primary-dark);
}

.export-button i {
    margin-right: 8px;
}

/* Customer Table Styles */
.customer-table-container {
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    margin-bottom: 30px;
}

.customer-table {
    width: 100%;
    border-collapse: collapse;
}

.customer-table th,
.customer-table td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid #eee;
}

.customer-table th {
    background-color: #f9f9f9;
    color: #666;
    font-weight: 600;
    position: relative;
    cursor: pointer;
}

.customer-table th:hover {
    background-color: #f0f0f0;
}

.customer-table th i {
    margin-left: 5px;
    font-size: 12px;
}

.customer-table tbody tr {
    transition: background-color 0.3s;
}

.customer-table tbody tr:hover {
    background-color: rgba(255, 193, 7, 0.05);
}

.customer-table tbody tr:last-child td {
    border-bottom: none;
}

.status-badge {
    padding: 6px 10px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    display: inline-block;
}

.status-active {
    background-color: rgba(76, 175, 80, 0.2);
    color: #4caf50;
}

.status-inactive {
    background-color: rgba(158, 158, 158, 0.2);
    color: #9e9e9e;
}

.status-pending {
    background-color: rgba(255, 193, 7, 0.2);
    color: var(--primary-dark);
}

.customer-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: #f0f0f0;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #666;
    font-weight: bold;
    margin-right: 10px;
    overflow: hidden;
}

.customer-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.customer-name-cell {
    display: flex;
    align-items: center;
}

.customer-info {
    margin-left: 10px;
}

.customer-name {
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 2px;
}

.customer-email {
    font-size: 12px;
    color: #888;
}

.action-cell {
    white-space: nowrap;
}

.action-button {
    background-color: transparent;
    border: none;
    color: #666;
    cursor: pointer;
    padding: 5px 10px;
    border-radius: 4px;
    transition: all 0.3s;
    margin-right: 5px;
}

.view-action:hover {
    background-color: rgba(33, 150, 243, 0.1);
    color: #2196f3;
}

.edit-action:hover {
    background-color: rgba(255, 193, 7, 0.2);
    color: var(--primary-dark);
}

.delete-action:hover {
    background-color: rgba(244, 67, 54, 0.1);
    color: #f44336;
}

/* Pagination Styles */
.pagination-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 20px;
}

.page-info {
    color: #666;
    font-size: 14px;
}

.pagination {
    display: flex;
    gap: 5px;
}

.pagination-button {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    background-color: white;
    border: 1px solid #ddd;
    transition: all 0.3s;
}

.pagination-button:hover {
    border-color: var(--primary);
}

.pagination-button.active {
    background-color: var(--primary);
    border-color: var(--primary);
    color: var(--text-dark);
    font-weight: bold;
}

.pagination-button.disabled {
    cursor: not-allowed;
    color: #ddd;
}

.items-per-page {
    display: flex;
    align-items: center;
    gap: 10px;
}

.items-per-page select {
    padding: 5px 10px;
    border-radius: 4px;
    border: 1px solid #ddd;
    cursor: pointer;
}

@media (max-width: 992px) {
    .customer-controls {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
    }
    
    .search-container {
        max-width: 100%;
    }
    
    .customer-table-container {
        overflow-x: auto;
    }
    
    .pagination-container {
        flex-direction: column;
        gap: 15px;
    }
    
    .pagination {
        justify-content: center;
    }
}

@media (max-width: 768px) {
    .filter-options {
        overflow-x: auto;
        padding-bottom: 10px;
    }
    
    .customer-table th:nth-child(4),
    .customer-table td:nth-child(4) {
        display: none;
    }
}

@media (max-width: 576px) {
    .customer-table th:nth-child(3),
    .customer-table td:nth-child(3),
    .customer-table th:nth-child(5),
    .customer-table td:nth-child(5) {
        display: none;
    }
}
{% endblock %}

{% block content %}
<!-- Customer Management Controls -->
<div class="customer-controls">
    <div class="search-container">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Search customers..." id="customer-search">
    </div>
    
    <div class="filter-options">
        <div class="filter-button active" data-filter="all">
            <i class="fas fa-users"></i>
            All
        </div>
        <div class="filter-button" data-filter="active">
            <i class="fas fa-check-circle"></i>
            Active
        </div>
        <div class="filter-button" data-filter="pending">
            <i class="fas fa-clock"></i>
            Pending
        </div>
        <div class="filter-button" data-filter="inactive">
            <i class="fas fa-times-circle"></i>
            Inactive
        </div>
    </div>
    
    <button class="export-button">
        <i class="fas fa-download"></i>
        Export
    </button>
</div>

<!-- Customer Table -->
<div class="customer-table-container">
    <table class="customer-table" id="customer-table">
        <thead>
            <tr>
                <th>Customer <i class="fas fa-sort"></i></th>
                <th>Phone <i class="fas fa-sort"></i></th>
                <th>Policies <i class="fas fa-sort"></i></th>
                <th>Total Premium <i class="fas fa-sort"></i></th>
                <th>Joined On <i class="fas fa-sort"></i></th>
                <th>Status <i class="fas fa-sort"></i></th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for customer in customers %}
            <tr data-status="{{ customer.status }}">
                <td>
                    <div class="customer-name-cell">
                        <div class="customer-avatar">
                            {% if customer.profile %}
                            <img src="{{ customer.profile.url }}" alt="{{ customer.name }}">
                            {% else %}
                            {{ customer.name|slice:"0:1" }}
                            {% endif %}
                        </div>
                        <div class="customer-info">
                            <div class="customer-name">{{ customer.name }}</div>
                            <div class="customer-email">{{ customer.email }}</div>
                        </div>
                    </div>
                </td>
                <td>{{ customer.mobile }}</td>
                <td>{{ customer.policy_count }}</td>
                <td>â‚¹{{ customer.total_premium }}</td>
                <td>{{ customer.created_at }}</td>
                <td>
                    <span class="status-badge status-{{ customer.is_verified }}">
                        {% if customer.is_verified %}
                        Active
                        {% else %}
                        Inactive
                        {% endif %}
                    </span>
                </td>
                <td class="action-cell">
                    <button class="action-button view-action" title="View Details">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="action-button edit-action" title="Edit Customer">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-button delete-action" title="Delete Customer">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" style="text-align: center; padding: 30px;">
                    <div style="color: #888;">
                        <i class="fas fa-users" style="font-size: 48px; margin-bottom: 15px; color: #ddd;"></i>
                        <p>No customers found</p>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
<div class="pagination-container">
    <div class="page-info">
        Showing <span id="showing-start">1</span> to <span id="showing-end">10</span> of <span id="total-entries">{{ total_customers }}</span> entries
    </div>
    
    <div class="pagination">
        <div class="pagination-button disabled" id="prev-page">
            <i class="fas fa-chevron-left"></i>
        </div>
        <div class="pagination-button active">1</div>
        <div class="pagination-button">2</div>
        <div class="pagination-button">3</div>
        <div class="pagination-button">...</div>
        <div class="pagination-button">10</div>
        <div class="pagination-button" id="next-page">
            <i class="fas fa-chevron-right"></i>
        </div>
    </div>
    
    <div class="items-per-page">
        <span>Show</span>
        <select id="items-per-page">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
        </select>
        <span>entries</span>
    </div>
</div>
{% endblock %}

{% block additional_scripts %}
// Filter functionality
document.querySelectorAll('.filter-button').forEach(button => {
    button.addEventListener('click', function() {
        // Update active state
        document.querySelectorAll('.filter-button').forEach(btn => {
            btn.classList.remove('active');
        });
        this.classList.add('active');
        
        // Apply filter
        const filter = this.getAttribute('data-filter');
        const rows = document.querySelectorAll('#customer-table tbody tr');
        
        rows.forEach(row => {
            if (filter === 'all' || row.getAttribute('data-status') === filter) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
        
        // Show loading animation
        document.getElementById('loading-screen').style.display = 'flex';
        
        // Hide loading after a delay to simulate filtering
        setTimeout(() => {
            document.getElementById('loading-screen').style.display = 'none';
        }, 500);
    });
});

// Search functionality
const searchInput = document.getElementById('customer-search');
searchInput.addEventListener('input', function() {
    const searchTerm = this.value.toLowerCase();
    const rows = document.querySelectorAll('#customer-table tbody tr');
    
    rows.forEach(row => {
        const nameCell = row.querySelector('.customer-name');
        const emailCell = row.querySelector('.customer-email');
        const phoneCell = row.cells[1];
        
        if (!nameCell || !emailCell || !phoneCell) return;
        
        const name = nameCell.textContent.toLowerCase();
        const email = emailCell.textContent.toLowerCase();
        const phone = phoneCell.textContent.toLowerCase();
        
        if (name.includes(searchTerm) || email.includes(searchTerm) || phone.includes(searchTerm)) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
});

// Export button handler
document.querySelector('.export-button').addEventListener('click', function() {
    // Show loading animation
    document.getElementById('loading-screen').style.display = 'flex';
    
    // Hide loading after a delay to simulate export processing
    setTimeout(() => {
        document.getElementById('loading-screen').style.display = 'none';
        alert('Customer data exported successfully');
    }, 1000);
});

// Sorting functionality (basic implementation)
document.querySelectorAll('.customer-table th').forEach(header => {
    header.addEventListener('click', function() {
        // Show loading animation
        document.getElementById('loading-screen').style.display = 'flex';
        
        // Hide loading after a delay to simulate sorting
        setTimeout(() => {
            document.getElementById('loading-screen').style.display = 'none';
            // Toggle sort direction indicator
            const icon = this.querySelector('i');
            if (icon.classList.contains('fa-sort')) {
                icon.classList.remove('fa-sort');
                icon.classList.add('fa-sort-up');
            } else if (icon.classList.contains('fa-sort-up')) {
                icon.classList.remove('fa-sort-up');
                icon.classList.add('fa-sort-down');
            } else {
                icon.classList.remove('fa-sort-down');
                icon.classList.add('fa-sort-up');
            }
        }, 500);
    });
});

// Pagination controls
document.querySelectorAll('.pagination-button:not(.disabled)').forEach(button => {
    button.addEventListener('click', function() {
        if (this.id === 'prev-page' || this.id === 'next-page') return;
        
        document.querySelectorAll('.pagination-button').forEach(btn => {
            btn.classList.remove('active');
        });
        this.classList.add('active');
        
        // Show loading animation
        document.getElementById('loading-screen').style.display = 'flex';
        
        // Hide loading after a delay to simulate page change
        setTimeout(() => {
            document.getElementById('loading-screen').style.display = 'none';
        }, 500);
    });
});

// Action buttons handlers
document.querySelectorAll('.action-button').forEach(button => {
    button.addEventListener('click', function(e) {
        e.stopPropagation();
        
        // Show loading animation
        document.getElementById('loading-screen').style.display = 'flex';
        
        // Get action type and customer name
        const action = this.classList.contains('view-action') ? 'view' : 
                      this.classList.contains('edit-action') ? 'edit' : 'delete';
        
        const customerRow = this.closest('tr');
        const customerName = customerRow.querySelector('.customer-name').textContent;
        
        // Hide loading after a delay
        setTimeout(() => {
            document.getElementById('loading-screen').style.display = 'none';
            
            if (action === 'view') {
                alert(`Viewing details for ${customerName}`);
                // In a real implementation, redirect to customer detail page
                // window.location.href = '/admin/customers/' + customerId;
            } else if (action === 'edit') {
                alert(`Editing customer: ${customerName}`);
                // In a real implementation, redirect to customer edit page
                // window.location.href = '/admin/customers/' + customerId + '/edit';
            } else if (action === 'delete') {
                if (confirm(`Are you sure you want to delete customer: ${customerName}?`)) {
                    alert(`Customer ${customerName} deleted successfully`);
                    customerRow.remove();
                }
            }
        }, 500);
    });
});

// Items per page change handler
document.getElementById('items-per-page').addEventListener('change', function() {
    // Show loading animation
    document.getElementById('loading-screen').style.display = 'flex';
    
    // Hide loading after a delay
    setTimeout(() => {
        document.getElementById('loading-screen').style.display = 'none';
        document.getElementById('showing-end').textContent = this.value;
    }, 500);
});

// Table row click handler for details view
document.querySelectorAll('#customer-table tbody tr').forEach(row => {
    row.addEventListener('click', function() {
        const customerName = this.querySelector('.customer-name')?.textContent;
        if (!customerName) return;
        
        // Show loading animation
        document.getElementById('loading-screen').style.display = 'flex';
        
        // Hide loading after a delay
        setTimeout(() => {
            document.getElementById('loading-screen').style.display = 'none';
            // In a real implementation, redirect to customer detail page
            alert(`Viewing details for ${customerName}`);
            // window.location.href = '/admin/customers/' + customerId;
        }, 500);
    });
});
{% endblock %}